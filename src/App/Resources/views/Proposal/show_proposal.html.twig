{% extends 'Proposal/layout_proposal.html.twig' %}

{% block page_content %}
    <div class="section-menu row">
        <ul>
            <li class="active"><a data-toggle="tab" href="#motivation">Motifs</a></li>
            <li><a data-toggle="tab" href="#articles">Articles</a></li>
            <li><a data-toggle="tab" href="#discussions">Salon</a></li>
            <li><a data-toggle="tab" href="#history">Historique</a></li>
        </ul>
    </div>
    <div class="tab-content">
        <div id="motivation" class="tab-pane fade in active">
            {{ proposal.motivation | markdown }}
        </div>
        <div id="articles" class="tab-pane fade">
            <table class="table discussion-table">
                <tbody>
                {% for article in proposal.articles %}
                    <tr>
                        <td>Article {{ proposal.articles.indexOf(article) + 1 }}</td>
                        <td><a href="{{ path('article_show', {'slug': article.slug}) }}" class="article-link">{{ article.title }}</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div id="discussions" class="tab-pane fade">
            <table class="table discussion-table">
                <thead>
                    <tr>
                        <th>Discussion</th>
                        <th>Dernier commentaire</th>
                    </tr>
                </thead>
                <tbody>
                {% for discussion in proposal.discussions %}
                    <tr>
                        <td><a href="{{ path('public_discussion_show', {'slug': discussion.slug}) }}" class="discussion-link">{{ discussion.title }}</a></td>
                        {% if discussion.posts is empty %}
                            <td>Vide</td>
                        {% else %}
                            <td>{{ discussion.lastPost.date|date('d/m/Y à  H:i')}} par {{ discussion.lastPost.author.username }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div id="history" class="tab-pane fade">
            <div class="subsection-content col-md-10 col-xs-10">
                {% for oldProposal in proposal.history %}
                    <a href="{{ path('old_proposal_show', {'slug': oldProposal.slug}) }}" class="subsection-panel col-md-12 col-xs-12">
                        <div class="subsection-panel-heading">
                            <div class="subsection-panel-title">
                                version {{ oldProposal.oldVersionNumber }}
                            </div>
                        </div>
                        <div class="subsection-panel-body">
                            par {{ oldProposal.oldAuthor.username }} le  {{ oldProposal.snapDate|date('d/m/Y') }}
                        </div>
                    </a>
                {% else %}
                    Pas d'historique !
                {% endfor %}
            </div>
            <div class="col-md-2 col-xs-2">
                Date de création : {{ proposal.creationDate|date('d/m/Y') }}<br><br>
                Date de dernière modification : {{ proposal.lastEditDate|date('d/m/Y') }}<br><br>
                Version actuelle : {{ proposal.versionNumber }}
            </div>
        </div>
    </div>
{% endblock page_content %}
