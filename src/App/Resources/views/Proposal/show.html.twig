{% extends '::layout.html.twig' %}

{% block page_content %}

    <h1>{{proposal.title}}</h1>

    {% if proposal.webPath is empty %}
        <img src="{{ asset('img/science128.png') }}" class="marginAuto">
    {% else %}
        <img src="{{ asset(proposal.webPath) }}" class="marginAuto">
    {% endif %}

    <p>
        Classée dans la thématique : <a href="{{ path('theme_show', {'slug': proposal.theme.slug}) }}">{{proposal.theme.title}}</a>
        <br>
        Date de création : {{ proposal.creationDate|date('d/m/Y') }}
        <br>
        Date de dernière modification : {{ proposal.editDate|date('d/m/Y') }}
        <br>
        Auteur principal : {{ proposal.mainAuthor }}
        {% if proposal.isPublic %}
            <br>
            Proposition publique !
        {% endif %}
    </p>

    <h2>Auteur(es) secondaire(s)</h2>

    <p>
        {% if proposal.sideAuthors is empty %}
            <p>Cette proposition n'a pas d'auteur secondaire</p>
        {% else%}
            {% for author in proposal.sideAuthors %}
                {{ author }}
            {% endfor %}
        {% endif %}

        {% if is_granted('sideauthor', proposal) %}
            <br>
            <a href="{{ path('proposal_removesideauthor', {'slug': proposal.slug}) }}">Je ne veux plus être auteur secondaire</a>
        {% endif %}
    </p>

    <h2>Soutien(s)</h2>
        {% if is_granted('neutral', proposal) %}
            <a href="{{ path('proposal_support', {'slug': proposal.slug}) }}">Soutenir cette proposition</a>
        {% elseif is_granted('supporter', proposal) %}
            <a href="{{ path('proposal_removesupport', {'slug': proposal.slug}) }}">Ne plus soutenir cette proposition</a>
        {% endif %}

    <p>
        {% if proposal.supportiveUsers is empty %}
            <p>Cette proposition n'a pas de soutien</p>
        {% else%}
            {% for user in proposal.supportiveUsers %}
                {{ user }}
            {% endfor %}
        {% endif %}
    </p>

    <h2>Contestataire(s)</h2>
        {% if is_granted('neutral', proposal) %}
            <a href="{{ path('proposal_oppose', {'slug': proposal.slug}) }}">Contester cette proposition</a>
        {% elseif is_granted('opponent', proposal) %}
            <a href="{{ path('proposal_removeoppose', {'slug': proposal.slug}) }}">Ne plus contester cette proposition</a>
        {% endif %}

    <p>
        {% if proposal.opposedUsers is empty %}
            <p>Cette proposition n'a pas de contestataire</p>
        {% else%}
            {% for user in proposal.opposedUsers %}
                {{ user }}
            {% endfor %}
        {% endif %}
    </p>

    <h2>Abstract</h2>

    {{ proposal.abstract }}

    <h2>Contenu</h2>

    {{ proposal.content }}

    <h2>Discussion</h2>

    {% if proposal.comments is empty %}
        <p>La discussion n'a pas encore débuté !</p>
    {% else%}
        {% for comment in proposal.comments %}
            <p>
                {{ comment.creationDate|date('d/m/Y') }}
                <br>
                {{ comment.author }}
                <br>
                {{ comment.content }}
                <br>
            </p>
        {% endfor %}
    {% endif %}

    {% if form is defined %}
        {{ form(form) }}
    {% endif %}

    <h2>Historique de la proposition</h2>

    <p>Version actuelle : {{ proposal.versionNumber }}</p>

    {% for version in proposal.versions %}
        <p>
            <a href="{{ path('proposalversion_show', {'slug': version.slug}) }}"> version {{ version.versionNumber }}</a> par {{ version.modifyingAuthor.username }} {{ version.date|date('d/m/Y') }}<br>
        </p>
    {% endfor %}

    {% if is_granted('edit', proposal) %}
        <hr>
        <h2>Administration</h2>
            <a href="{{ path('proposal_edit', {'slug': proposal.slug}) }}">Modifier cette proposition</a><br>
        {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('proposal_delete', {'slug': proposal.slug}) }}">Supprimer cette proposition</a>
        {% endif %}
    {% endif %}
{% endblock page_content %}

{% block javascript %}
    {{ parent() }}
{% endblock javascript %}
